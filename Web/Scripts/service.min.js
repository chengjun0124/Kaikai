(function(){app.factory("locationEx",["$location",function(n){return n.queryString=function(t){var i=n.absUrl().match(new RegExp("[?&]"+t+"=([^#&]*)"));return i==null?null:i[1]},n}]);app.factory("routeService",["$state",function(n){return{goParams:function(t,i){$("html, body").scrollTop(0);n.go(t,i,{reload:!0})}}}]);app.factory("dialogService",["ngDialog","$rootScope","routeService",function(n,t,i){var r,u;return window.closeUploadDialog=function(){r.close()},window.receiveDataURL=function(n){r.close();t.$apply(function(){u(n)})},{showMention:function(r,u,f,e){var o=n.open({template:t.dialogMentionTemplate,plain:!1,showClose:!1,closeByEscape:!1,overlay:!0,className:"ngdialog-theme-mention",closeByDocument:!1,controller:["$scope",function(n){n.close=function(){o.close();f&&i.goParams(f)};n.confirm=function(){o.close();e();f&&i.goParams(f)}}],data:{buttonCount:r,content:u}})},showUpload:function(t,i,f){u=f;r=n.open({template:'<iframe src="photoclip/demo.html?w='+t+"&h="+i+'"><\/iframe>',plain:!0,showClose:!1,closeByEscape:!0,overlay:!1,className:"ngdialog-theme-upload",closeByDocument:!0})},showSycnOrderDetail:function(i){var r=n.open({template:t.dialogSyncOrderDetailTemplate,plain:!1,showClose:!1,closeByEscape:!1,overlay:!0,className:"ngdialog-theme-syncorderdetail",closeByDocument:!0,controller:["$scope",function(n){n.order={};n.order.hasLongSleeve=!0;n.order.hasShortSleeve=!1;n.order.orderDetails=[];n.order.orderDetails.push({color:"",cloth:"",amount:"1",isLongSleeve:!0});n.order.orderDetails.push({color:"",cloth:"",amount:"1",isLongSleeve:!1});n.addDetail=function(t,i){i&&n.order.orderDetails.push({color:"",cloth:"",amount:"1",isLongSleeve:t})};n.isShowDelete=function(t){for(var r=0,i=0;i<n.order.orderDetails.length;i++)if(n.order.orderDetails[i].isLongSleeve==t&&r++,r==2)return!0};n.deleteDetail=function(t,i){if(t){var r=n.order.orderDetails.indexOf(i);n.order.orderDetails.splice(r,1)}};n.isOrderDetailRequired=function(t){for(var r=0,i=0;i<n.order.orderDetails.length;i++)if(n.order.orderDetails[i].isLongSleeve==t&&r++,r==2)return!0;return!1};n.sync=function(){for(var t=0;t<i.length;t++)i[t].hasLongSleeve=n.order.hasLongSleeve,i[t].hasShortSleeve=n.order.hasShortSleeve,i[t].orderDetails=clone(n.order.orderDetails);r.close()}}]})}}}]);app.factory("storageService",[function(){return{set:function(n,t){localStorage[n]=t},get:function(n){return localStorage[n]},setSession:function(n,t){sessionStorage[n]=t},getSession:function(n){return sessionStorage[n]},removeSession:function(n){delete sessionStorage[n]}}}]);app.factory("apiService",["$http","routeService","ngDialog","storageService","locationEx","dialogService","$rootScope",function(n,t,i,r,u,f,e){function c(n){var i,r,u;if(n.status==500)t.goParams("error");else if(n.status==404)t.goParams("error",{msg:encodeURIComponent("您请求的数据不存在，请返回首页重新浏览")});else if(n.status==400)for($(".invalid_msg").text(""),i=0;i<n.data.length;i++)u=n.data[i].id.match(/^(.+_)(\d+)$/),u!=null?(r=e.invalidMapping[u[1]],r=r+u[2]):r=e.invalidMapping[n.data[i].id],$("#"+r).text(n.data[i].message);else n.status==401?t.goParams("login"):t.goParams("error");return!1}function s(n){this.promise=n;this.then=function(n,t){var i=this.promise.then(function(t){if(!t)return!1;o--;o==0&&h.close();var i=null;return n&&(i=n(t)),i instanceof s?i.promise:i},function(n){if(o=0,h.close(),t==null)c(n);else{var i=t(n);return i instanceof s?i.promise:i}});return new s(i)}}var o=0,h=null;return{call:function(t,u,f,c){var l,a,v;return o==0&&(h=i.open({template:'<div class="sk-circle"><div class="sk-circle1 sk-child"><\/div><div class="sk-circle2 sk-child"><\/div><div class="sk-circle3 sk-child"><\/div><div class="sk-circle4 sk-child"><\/div><div class="sk-circle5 sk-child"><\/div><div class="sk-circle6 sk-child"><\/div><div class="sk-circle7 sk-child"><\/div><div class="sk-circle8 sk-child"><\/div><div class="sk-circle9 sk-child"><\/div><div class="sk-circle10 sk-child"><\/div><div class="sk-circle11 sk-child"><\/div><div class="sk-circle12 sk-child"><\/div><\/div>',className:"ngdialog-theme-loading",plain:!0,showClose:!1,closeByEscape:!1,closeByDocument:!1})),o++,l=r.getSession("jwt"),a={},l!=null&&(a.Authorization=l),c==undefined&&(c=""),v=n({url:e.APIURL+u,method:t,data:f,headers:a,responseType:c}),new s(v)}}}])})();