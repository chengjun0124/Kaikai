app.controller("order_edit",["$scope","orderAPIService","sizeAPIService","$stateParams","routeService","$rootScope","dialogService",function(n,t,i,r,u,f,e){n.isCreate=r.orderId==""?!0:!1;f.invalidMapping={group:"td_m_group",company:"td_m_company",department:"td_m_department",job:"td_m_job",employeecode:"td_m_employee_code",name:"td_m_name",age:"td_m_age",sex:"td_m_sex",height:"td_m_height",weight:"td_m_weight",neck:"td_m_neck",shoulder:"td_m_shoulder",flength:"td_m_flength",blength:"td_m_blength",chest:"td_m_chest",waist:"td_m_waist",lowerhem:"td_m_lowerhem",presize:"td_m_presize",lsleevelength:"td_m_lsleevelength",lsleevecuff:"td_m_lsleevecuff",lprice:"td_m_lprice",ssleevelength:"td_m_ssleevelength",ssleevecuff:"td_m_ssleevecuff",sprice:"td_m_sprice",memo:"td_m_memo",chestenlarge:"td_m_chestenlarge",waistenlarge:"td_m_waistenlarge",lowerhemenlarge:"td_m_lowerhemenlarge",longsleeve:"td_m_longsleeve",shortsleeve:"td_m_shortsleeve",lcolor_:"td_lcolor_",lcloth_:"td_lcloth_",lamount_:"td_lamount_",scolor_:"td_scolor_",scloth_:"td_scloth_",samount_:"td_samount_"};n.order={};n.order.sex="M";n.order.chestEnlarge="15";n.order.waistEnlarge="15";n.order.lowerHemEnlarge="15";n.order.preSize="B";n.order.orderDetails=[];n.order.orderDetails.push({color:"",cloth:"",amount:"1",isLongSleeve:!0});n.order.orderDetails.push({color:"",cloth:"",amount:"1",isLongSleeve:!1});n.order.hasLongSleeve=!0;n.order.hasShortSleeve=!1;n.sizeDetails=null;n.isCreate||t.getOrder(r.orderId).then(function(t){var r,i;for(n.order=t.data,r=!1,i=0;i<n.order.orderDetails.length;i++)if(n.order.orderDetails[i].isLongSleeve==!0){r=!0;break}for(r||n.order.orderDetails.push({color:"",cloth:"",amount:"1",isLongSleeve:!0}),r=!1,i=0;i<n.order.orderDetails.length;i++)if(n.order.orderDetails[i].isLongSleeve==!1){r=!0;break}r||n.order.orderDetails.push({color:"",cloth:"",amount:"1",isLongSleeve:!1})});n.clearSize=function(t,i,r){i&&(n.order.neck="",n.order.shoulder="",n.order.fLength="",n.order.bLength="",n.order.chest="",n.order.waist="",n.order.lowerHem="",n.order.lSleeveLength="",n.order.lSleeveCuff="",n.order.sSleeveLength="",n.order.sSleeveCuff="",n.order.chestEnlarge="",n.order.waistEnlarge="",n.order.lowerHemEnlarge="");t&&(n.order.sizeName="",(n.order.chestEnlarge==null||n.order.chestEnlarge=="")&&(n.order.chestEnlarge=n.order.sex=="M"?"15":"10"),(n.order.waistEnlarge==null||n.order.waistEnlarge=="")&&(n.order.waistEnlarge=n.order.sex=="M"?"15":"10"),(n.order.lowerHemEnlarge==null||n.order.lowerHemEnlarge=="")&&(n.order.lowerHemEnlarge=n.order.sex=="M"?"15":"10"));r&&(n.order.chestEnlarge=n.order.sex=="M"?"15":"10",n.order.waistEnlarge=n.order.sex=="M"?"15":"10",n.order.lowerHemEnlarge=n.order.sex=="M"?"15":"10")};n.hasSizeName=function(){return n.order.sizeName==null||n.order.sizeName==""?!1:!0};n.submit=function(){n.isCreate?t.createOrder(n.order).then(function(){$(".invalid_msg").text("");e.showMention("1","创建订单成功，可继续创建订单");n.order.employeeCode="";n.order.name="";n.order.age="";n.order.height="";n.order.weight="";n.order.neck="";n.order.shoulder="";n.order.fLength="";n.order.bLength="";n.order.chest="";n.order.waist="";n.order.lowerHem="";n.order.preSize="B";n.order.lSleeveLength="";n.order.lSleeveCuff="";n.order.lPrice="";n.order.sSleeveLength="";n.order.sSleeveCuff="";n.order.sPrice="";n.order.memo="";n.order.sizeName="";n.order.chestEnlarge=n.order.sex=="M"?"15":"10";n.order.waistEnlarge=n.order.sex=="M"?"15":"10";n.order.lowerHemEnlarge=n.order.sex=="M"?"15":"10"}):t.updateOrder(n.order).then(function(){opener.$("#ui_view").scope().refreshOrders();this.close()})};n.addDetail=function(t,i){i&&n.order.orderDetails.push({color:"",cloth:"",amount:"1",isLongSleeve:t})};n.isShowDelete=function(t){for(var r=0,i=0;i<n.order.orderDetails.length;i++)if(n.order.orderDetails[i].isLongSleeve==t&&r++,r==2)return!0};i.getDefaultSizeDetails().then(function(t){n.sizeDetails=t.data});n.deleteDetail=function(t,i){if(t){var r=n.order.orderDetails.indexOf(i);n.order.orderDetails.splice(r,1)}};n.isOrderDetailRequired=function(t){for(var r=0,i=0;i<n.order.orderDetails.length;i++)if(n.order.orderDetails[i].isLongSleeve==t&&r++,r==2)return!0;return!1}}]);